import java.util.PriorityQueue;
import java.util.Queue;

public class ElevatorManager implements Runnable
{
	private Queue<Integer> upRequests;
	private Queue<Integer> pendingUpRequests;
	
	private Queue<Integer> downRequests;
	private Queue<Integer> pendingDownRequests;
	
	private Elevator elevator;
	private boolean isUp;
	
	public ElevatorManager()
	{
		upRequests = new PriorityQueue<Integer>(1, (a, b) -> a - b);
		pendingUpRequests = new PriorityQueue<Integer>(1, (a, b) -> a - b);
		
		downRequests = new PriorityQueue<Integer>(1, (a, b) -> b - a);
		pendingDownRequests = new PriorityQueue<Integer>(1, (a, b) -> b - a);
		
		elevator = ElevatorFactory.getElevator();
		isUp = true;
	}
	
	public void run() 
	{
		while (true) 
		{
			processRequest();
		}
	}
	
	public void pressButton(int fromFloor, int toFloor)
	{
		addRequest(new Request(fromFloor, toFloor));
	}
	
	private void processRequest()
	{
		if (!upRequests.isEmpty())
		{
			isUp = true;
			
			while (!upRequests.isEmpty())
			{
				int targetFloor = upRequests.poll();
				elevator.moveToTargetFloor(targetFloor);
			}
		}
		
		if (!downRequests.isEmpty())
		{
			isUp = false;
			
			while (!downRequests.isEmpty())
			{
				int targetFloor = downRequests.poll();
				elevator.moveToTargetFloor(targetFloor);
			}
		}
	}
	
	private void addRequest(Request request)
	{
		if (request.isUp())
		{
			if (request.getFromFloor() > elevator.getCurrentFloor())
			{
				upRequests.add(request.getFromFloor());
				upRequests.add(request.getToFloor());
			}
			else
			{
				pendingUpRequests.add(request.getFromFloor());
				pendingUpRequests.add(request.getToFloor());
			}
		}
		else
		{
			if (request.getFromFloor() < elevator.getCurrentFloor())
			{
				downRequests.add(request.getFromFloor());
				downRequests.add(request.getToFloor());
			}
			else
			{
				pendingDownRequests.add(request.getFromFloor());
				pendingDownRequests.add(request.getToFloor());
			}
		}
	}
}
