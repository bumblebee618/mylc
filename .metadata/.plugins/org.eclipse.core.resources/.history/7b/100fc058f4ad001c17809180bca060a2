import java.util.HashMap;
import java.util.HashSet;
import java.util.LinkedList;
import java.util.List;
import java.util.Map;
import java.util.Queue;
import java.util.Set;

public class Q_bus_route_with_path {
	private Set<Integer>[] routeGraph;
	private Map<Integer, Set<Integer>> stopToRouteMap;
	private Set<Integer> visitedStops;
	private Set<Integer> visitedRoutes;
	
	public List<Integer> numBusesToDestination(int[][] routes, int source, int target) {
		List<Integer> result = new LinkedList<>();
		
        if (routes == null || routes.length == 0 || routes[0].length == 0 || source < 0 || target < 0) {
            return result;
        } else if (source == target) {
            return result;
        }
        
        int routeSize = routes.length;
        routeGraph = new Set[routeSize];
        stopToRouteMap = new HashMap<>();
        visitedRoutes = new HashSet<>();
        visitedStops = new HashSet<>();
        
        for (int i = 0; i < routeSize; i++) {
        	routeGraph[i] = new HashSet<>();
        	
        	for (int stop : routes[i]) {
				routeGraph[i].add(stop);
        		stopToRouteMap.computeIfAbsent(stop, x -> new HashSet<>()).add(i);
        	}
        }
        
        if (!stopToRouteMap.containsKey(source) || !stopToRouteMap.containsKey(target)) {
            return result;
        }
        
        Queue<Node> queue = new LinkedList<>();
        visitedStops.add(source);
        
        for (int route : stopToRouteMap.get(source)) {
        	queue.offer(new Node(route, -1));
        	visitedRoutes.add(route);
        }
        
        int step = 0;
        
        while (!queue.isEmpty()) {
        	int size = queue.size();
        	step++;
        	
        	for (int i = 0; i < size; i++) {
        		Node curNode = queue.poll();
        		
        		if (routeGraph[curNode.route].contains(target)) {
        			while (curNode.lastRoute != -1) {
        				result.add(curNode.route);
        				curNode 
        			}
        			
        			return result;
        		}
        		
        		findNextRoute(queue, curNode.route);
        	}
        }
        
        return result;
	}
	
	private void findNextRoute(Queue<Node> queue, int route) {
		for (int stop : stopToRouteMap.get(route)) {
			if (visitedStops.contains(stop) || !stopToRouteMap.containsKey(stop)) {
				continue;
			}
			
			for (int nextRoute : stopToRouteMap.get(stop)) {
				if (!visitedRoutes.contains(nextRoute)) {
					queue.offer(new Node(nextRoute, route));
					visitedRoutes.add(nextRoute);
				}
			}
		}
	}
	
	class Node {
		public int route;
		public Node lastNode;
		
		public Node(int r, Node l) {
			route = r;
			lastNode = l;
		}
	}
}
